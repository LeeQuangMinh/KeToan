<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <style>
        body { font-family: "Times New Roman", serif; padding: 1cm; color: black; line-height: 1.2; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid black; padding: 5px; font-size: 14px; }
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .bold { font-weight: bold; }
        .italic { font-style: italic; }
        @media print { .no-print { display: none; } }
    </style>
</head>
<body>
    <div class="no-print"><button onclick="window.print()">In báo cáo (PDF)</button></div>

    <div style="display: flex; justify-content: space-between;">
        <div>
            <div class="bold">HỘ KINH DOANH: <span id="out_ten"></span></div>
            <div class="bold">MST: <span id="out_mst"></span></div>
            <div class="bold">Địa chỉ: <span id="out_dc"></span></div>
        </div>
        <div class="text-right" style="width: 45%; font-size: 12px;">
            <div class="bold">Mẫu số S2b-HKD</div>
            <div class="italic">(Thông tư số 152/2025/TT-BTC)</div>
        </div>
    </div>

    <div class="text-center" style="margin-top: 20px;">
        <h2 style="margin:0">SỔ DOANH THU BÁN HÀNG HÓA, DỊCH VỤ</h2>
        <div class="bold">Kỳ kê khai: <span id="out_ky"></span></div>
    </div>

    <table>
        <thead>
            <tr>
                <th colspan="2">Chứng từ</th>
                <th rowspan="2">Diễn giải</th>
                <th rowspan="2">Số tiền</th>
            </tr>
            <tr>
                <th>Số hiệu (A)</th>
                <th>Ngày (B)</th>
            </tr>
        </thead>
        <tbody id="out_body"></tbody>
        <tfoot class="bold">
            <tr>
                <td colspan="3" class="text-center">Tổng cộng</td>
                <td class="text-right" id="out_tong">0</td>
            </tr>
            <tr>
                <td colspan="3">Thuế GTGT (<span id="out_rate">0</span>%)</td>
                <td class="text-right" id="out_vat">0</td>
            </tr>
            <tr style="background: #eee;">
                <td colspan="3">Tổng thuế phải nộp</td>
                <td class="text-right" id="out_sum_vat">0</td>
            </tr>
        </tfoot>
    </table>

    <script>
        window.onload = function() {
            const data = JSON.parse(decodeURIComponent(window.location.hash.substring(1)));
            
            document.getElementById('out_ten').innerText = data.tenHKD;
            document.getElementById('out_mst').innerText = data.mst;
            document.getElementById('out_dc').innerText = data.diaChi;
            document.getElementById('out_ky').innerText = "Quý " + data.quy + " Năm " + data.nam;
            document.getElementById('out_rate').innerText = data.thueSuat;

            let html = ""; let tong = 0;
            data.danhSachDong.forEach(item => {
                let st = parseFloat(item.st) || 0;
                tong += st;
                html += `<tr>
                    <td class="text-center">${item.sh}</td>
                    <td class="text-center">${item.ng}</td>
                    <td>${item.dg}</td>
                    <td class="text-right">${st.toLocaleString('vi-VN')}</td>
                </tr>`;
            });

            document.getElementById('out_body').innerHTML = html;
            document.getElementById('out_tong').innerText = tong.toLocaleString('vi-VN');
            
            let thue = tong * (parseFloat(data.thueSuat) / 100);
            document.getElementById('out_vat').innerText = thue.toLocaleString('vi-VN');
            document.getElementById('out_sum_vat').innerText = thue.toLocaleString('vi-VN');
        };
    </script>
</body>
</html>

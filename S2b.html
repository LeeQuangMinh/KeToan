<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Mẫu S2b-HKD Thông tư 152</title>
    <style>
        body { font-family: "Times New Roman", Times, serif; padding: 1cm; line-height: 1.3; color: black; }
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .bold { font-weight: bold; }
        .italic { font-style: italic; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid black; padding: 8px; }
        .no-border { border: none !important; }
        .header-info { margin-bottom: 20px; }
        @media print { .no-print { display: none; } }
    </style>
</head>
<body>
    <div class="no-print" style="margin-bottom: 20px;">
        <button onclick="window.print()" style="padding: 10px 20px; cursor: pointer;">In báo cáo (PDF)</button>
    </div>

    <div style="display: flex; justify-content: space-between;">
        <div class="header-info">
            <div class="bold">HỘ, CÁ NHÂN KINH DOANH: <span id="out_tenHKD"></span></div>
            <div class="bold">Mã số thuế: <span id="out_mst"></span></div>
            <div class="bold">Địa chỉ: <span id="out_diaChi"></span></div>
        </div>
        <div class="text-right" style="width: 45%; font-size: 13px;">
            <div class="bold">Mẫu số S2b-HKD</div>
            <div>(Kèm theo Thông tư số 152/2025/TT-BTC ngày 31 tháng 12 năm 2025 của Bộ trưởng Bộ Tài chính)</div>
        </div>
    </div>

    <div class="text-center" style="margin-top: 10px;">
        <h2 style="margin-bottom: 5px;">SỔ DOANH THU BÁN HÀNG HÓA, DỊCH VỤ</h2>
        <div class="bold">Kỳ kê khai: <span id="out_kyKhai"></span></div>
        <div class="text-right italic" style="margin-top: 5px;">Đơn vị tính: VNĐ</div>
    </div>

    <table>
        <thead>
            <tr>
                <th colspan="2">Chứng từ</th>
                <th rowspan="2">Diễn giải</th>
                <th rowspan="2">Số tiền</th>
            </tr>
            <tr>
                <th width="15%">Số hiệu<br><span class="italic" style="font-weight: normal;">(A)</span></th>
                <th width="15%">Ngày, tháng<br><span class="italic" style="font-weight: normal;">(B)</span></th>
            </tr>
        </thead>
        <tbody id="table_body">
            </tbody>
        <tfoot class="bold">
            <tr>
                <td colspan="3" class="text-center">Tổng cộng (1)</td>
                <td class="text-right" id="out_tongCong">0</td>
            </tr>
            <tr>
                <td colspan="3">Thuế GTGT</td>
                <td class="text-right" id="out_thueGTGT">0</td>
            </tr>
            <tr style="background-color: #f2f2f2;">
                <td colspan="3">Tổng số thuế GTGT phải nộp</td>
                <td class="text-right" id="out_tongPhaiNop">0</td>
            </tr>
        </tfoot>
    </table>

    <div style="margin-top: 30px; display: flex; justify-content: flex-end;">
        <div class="text-center" style="width: 40%;">
            <div class="italic">Ngày ...... tháng ...... năm ......</div>
            <div class="bold" style="margin-top: 10px;">NGƯỜI ĐẠI DIỆN HỘ KINH DOANH/<br>CÁ NHÂN KINH DOANH</div>
            <div class="italic" style="margin-top: 60px;">(Ký, họ tên, đóng dấu)</div>
        </div>
    </div>

    <script>
        window.onload = function() {
            // Lấy dữ liệu sau dấu #
            const hashData = window.location.hash.substring(1);
            if (!hashData) return;

            try {
                const data = JSON.parse(decodeURIComponent(hashData));

                // Hiển thị thông tin chung
                document.getElementById('out_tenHKD').innerText = data.tenHKD;
                document.getElementById('out_mst').innerText = data.mst;
                document.getElementById('out_diaChi').innerText = data.diaChi;
                document.getElementById('out_kyKhai').innerText = "Quý " + data.quy + " Năm " + data.nam;

                let tableBody = document.getElementById('table_body');
                let tongCong = 0;

                // Đổ dữ liệu bảng
                if (data.danhSachDong) {
                    data.danhSachDong.forEach(item => {
                        let st = parseFloat(item.soTien) || 0;
                        tongCong += st;

                        let row = `<tr>
                            <td class="text-center">${item.soHieu || ''}</td>
                            <td class="text-center">${item.ngay || ''}</td>
                            <td>${item.dienGiai || 'Doanh thu bán hàng, dịch vụ'}</td>
                            <td class="text-right">${st.toLocaleString('vi-VN')}</td>
                        </tr>`;
                        tableBody.innerHTML += row;
                    });
                }

                // Tính toán thuế (Giả sử thueSuat truyền vào hoặc mặc định 1.5%)
                let thueSuat = 1.5; 
                let tienThue = tongCong * (thueSuat / 100);

                document.getElementById('out_tongCong').innerText = tongCong.toLocaleString('vi-VN');
                document.getElementById('out_thueGTGT').innerText = tienThue.toLocaleString('vi-VN');
                document.getElementById('out_tongPhaiNop').innerText = tienThue.toLocaleString('vi-VN');

            } catch (e) {
                console.error("Lỗi xử lý dữ liệu:", e);
                alert("Dữ liệu không hợp lệ hoặc quá dài.");
            }
        };
    </script>
</body>
</html>

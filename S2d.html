<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Sổ chi tiết vật liệu S2d-HKD</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        @page { size: A4 landscape; margin: 10mm; } /* S2d nên in khổ ngang (landscape) */
        body { font-family: "Times New Roman", serif; color: black; line-height: 1.2; font-size: 10pt; margin: 0; padding: 0; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 10px; table-layout: fixed; }
        th, td { border: 1px solid black; padding: 4px; word-wrap: break-word; text-align: center; }
        
        /* Cấu trúc cột theo mẫu */
        .col-stt { width: 8%; }
        .col-dg { width: 15%; }
        .col-unit { width: 7%; }
        .col-val { width: 8%; }

        .text-left { text-align: left; }
        .bold { font-weight: bold; }
        .italic { font-style: italic; }
        .no-border, .no-border td { border: none !important; }

        .no-print { 
            position: sticky; top: 0; background: #fff; padding: 10px; 
            border-bottom: 1px solid #ddd; display: flex; gap: 10px; justify-content: center; z-index: 1000;
        }
        .btn { cursor: pointer; padding: 8px 15px; border: none; border-radius: 4px; font-weight: bold; color: white; }
        .btn-download { background: #d9534f; }
    </style>
</head>
<body>

    <div class="no-print">
        <button class="btn btn-download" onclick="downloadPDF()">TẢI PDF S2D (KHỔ NGANG)</button>
    </div>

    <div id="content-to-export" style="padding: 10px; background: white;">
        <table class="no-border">
            <tr>
                <td class="text-left" style="width: 60%;">
                    <div class="bold">HỘ KINH DOANH: <span id="out_ten"></span></div>
                    <div class="bold">MST: <span id="out_mst"></span></div>
                    <div class="bold">Địa chỉ: <span id="out_dc"></span></div>
                </td>
                <td class="text-right" style="vertical-align: top;">
                    <div class="bold">Mẫu số S2d-HKD</div>
                    <div class="italic" style="font-size: 9pt;">(Thông tư số 152/2025/TT-BTC)</div>
                </td>
            </tr>
        </table>

        <div class="text-center">
            <h2 style="margin: 10px 0 5px 0;">SỔ CHI TIẾT VẬT LIỆU, DỤNG CỤ, SẢN PHẨM, HÀNG HÓA</h2>
            <div>Tên vật liệu, dụng cụ, sản phẩm, hàng hóa: ...........................................................</div>
            <div class="bold">Kỳ kê khai: <span id="out_ky"></span></div>
            <div class="text-right italic">Đơn vị tính: Đồng</div>
        </div>

        <table>
            <thead>
                <tr>
                    <th colspan="2">Chứng từ</th>
                    <th rowspan="2" class="col-dg">Diễn giải</th>
                    <th rowspan="2" class="col-unit">Đơn vị tính</th>
                    <th rowspan="2" class="col-val">Đơn giá</th>
                    <th colspan="2">Nhập</th>
                    <th colspan="2">Xuất</th>
                    <th colspan="2">Tồn</th>
                    <th rowspan="2" style="width: 5%;">Ghi chú</th>
                </tr>
                <tr>
                    <th class="col-stt">Số hiệu</th>
                    <th class="col-stt">Ngày</th>
                    <th class="col-val">Số lượng</th>
                    <th class="col-val">Thành tiền</th>
                    <th class="col-val">Số lượng</th>
                    <th class="col-val">Thành tiền</th>
                    <th class="col-val">Số lượng</th>
                    <th class="col-val">Thành tiền</th>
                </tr>
                <tr class="italic" style="font-size: 9pt;">
                    <td>A</td><td>B</td><td>C</td><td>D</td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td><td>7</td><td>8</td>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td></td><td></td><td class="text-left">Số dư đầu kỳ</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                </tr>
                <script>
                    for(let i=0; i<10; i++) {
                        document.write("<tr><td>&nbsp;</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>");
                    }
                </script>
                <tr class="bold">
                    <td></td><td></td><td class="text-left">Cộng phát sinh trong kỳ</td><td>X</td><td>X</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                </tr>
                <tr class="bold">
                    <td></td><td></td><td class="text-left">Số dư cuối kỳ</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                </tr>
            </tbody>
        </table>

        <table class="no-border" style="margin-top: 20px;">
            <tr><td colspan="2"></td><td class="italic">Ngày ...... tháng ...... năm 20...</td></tr>
            <tr class="bold">
                <td>Người lập biểu</td>
                <td>Kế toán trưởng</td>
                <td>ĐẠI DIỆN HỘ KINH DOANH</td>
            </tr>
            <tr style="height: 60px;"><td></td><td></td><td></td></tr>
        </table>
    </div>

    <script>
        const hashData = window.location.hash.substring(1);
        if(hashData) {
            try {
                const data = JSON.parse(decodeURIComponent(hashData));
                document.getElementById('out_ten').innerText = data.tenHKD || "";
                document.getElementById('out_mst').innerText = data.mst || "";
                document.getElementById('out_dc').innerText = data.diaChi || "";
                document.getElementById('out_ky').innerText = `Quý ${data.quy} Năm ${data.nam}`;
            } catch (e) {}
        }

        function downloadPDF() {
            const element = document.getElementById('content-to-export');
            html2pdf().set({
                margin: [5, 5, 5, 5],
                filename: 'S2d_HKD.pdf',
                image: { type: 'jpeg', quality: 1 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'landscape' }
            }).from(element).save();
        }
    </script>
</body>
</html>
